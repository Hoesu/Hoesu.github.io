<script>
// 간단한 giscus 테마 동기화
function setupGiscusThemeSync() {
    let giscusIframe = null;

    // 현재 테마 감지
    function getCurrentTheme() {
    const html = document.documentElement;
    const body = document.body;
    
    let isDark = false;
    
    // 1. body 클래스 확인 (Hydejack의 테마 방식)
    if (body && body.classList.contains('light-mode')) {
        isDark = false;
    }
    else if (body && body.classList.contains('dark-mode')) {
        isDark = true;
    }
    // 2. data-dark 속성 확인
    else if (html.hasAttribute('data-dark')) {
        isDark = html.getAttribute('data-dark') === 'true';
    }
    // 3. html 클래스 확인
    else if (html.classList.contains('dark') || html.classList.contains('dark-mode')) {
        isDark = true;
    }
    // 4. CSS media query 확인 (시스템 설정)
    else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        isDark = true;
    }
    
    return isDark ? 'noborder_dark' : 'noborder_light';
    }

    // giscus 테마 업데이트
    function updateTheme() {
    if (!giscusIframe) {
        giscusIframe = document.querySelector('iframe[src*="giscus.app"]');
    }

    if (giscusIframe && giscusIframe.contentWindow) {
        const theme = getCurrentTheme();
        
        try {
        giscusIframe.contentWindow.postMessage({
            giscus: { setConfig: { theme: theme } }
        }, 'https://giscus.app');
        } catch (e) {
        console.warn('giscus 테마 업데이트 실패:', e);
        }
    }
    }

  // DOM 변경 감지
    const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && 
            (mutation.attributeName === 'data-dark' || mutation.attributeName === 'class')) {
        setTimeout(updateTheme, 100);
        }
    });
    });

    // 관찰 시작
    observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['data-dark', 'class']
    });

    if (document.body) {
    observer.observe(document.body, {
        attributes: true,
        attributeFilter: ['class']
    });
    }

    // giscus 로드 대기 및 초기 테마 설정
    let attempts = 0;
    const checkInterval = setInterval(() => {
    attempts++;
    giscusIframe = document.querySelector('iframe[src*="giscus.app"]');
    
    if (giscusIframe) {
        clearInterval(checkInterval);
        
        // 1초 후 초기 테마 설정
        setTimeout(updateTheme, 1000);
    } else if (attempts > 50) {
        clearInterval(checkInterval);
    }
    }, 200);

  // 디버깅용 전역 함수 (필요시 콘솔에서 window.giscusThemeTest() 실행)
    window.giscusThemeTest = updateTheme;
}

// 페이지 로드시 실행
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupGiscusThemeSync);
} else {
    setupGiscusThemeSync();
}

// Hydejack push state 지원
document.addEventListener('hy-push-state-load', function() {
    setTimeout(setupGiscusThemeSync, 500);
});
</script>

<script src="https://giscus.app/client.js"
    data-repo="Hoesu/Hoesu.github.io"
    data-repo-id="R_kgDOPg3pJg"
    data-category="Comments"
    data-category-id="DIC_kwDOPg3pJs4CuX1b"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="light"
    data-lang="ko"
    crossorigin="anonymous"
    async>
</script>